<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: EventMachine::Connection</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">EventMachine::Connection</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/lib/em/connection_rb.html">
                lib/em/connection.rb
                </a>
        <br />
                <a href="../../files/lib/em/pure_ruby_rb.html">
                lib/em/pure_ruby.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
@private
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000390">close_connection</a>&nbsp;&nbsp;
      <a href="#M000394">close_connection_after_writing</a>&nbsp;&nbsp;
      <a href="#M000406">comm_inactivity_timeout</a>&nbsp;&nbsp;
      <a href="#M000407">comm_inactivity_timeout=</a>&nbsp;&nbsp;
      <a href="#M000397">connection_completed</a>&nbsp;&nbsp;
      <a href="#M000391">detach</a>&nbsp;&nbsp;
      <a href="#M000396">error?</a>&nbsp;&nbsp;
      <a href="#M000405">get_idle_time</a>&nbsp;&nbsp;
      <a href="#M000422">get_outbound_data_size</a>&nbsp;&nbsp;
      <a href="#M000399">get_peer_cert</a>&nbsp;&nbsp;
      <a href="#M000401">get_peername</a>&nbsp;&nbsp;
      <a href="#M000403">get_pid</a>&nbsp;&nbsp;
      <a href="#M000389">get_proxied_bytes</a>&nbsp;&nbsp;
      <a href="#M000392">get_sock_opt</a>&nbsp;&nbsp;
      <a href="#M000402">get_sockname</a>&nbsp;&nbsp;
      <a href="#M000404">get_status</a>&nbsp;&nbsp;
      <a href="#M000379">new</a>&nbsp;&nbsp;
      <a href="#M000378">new</a>&nbsp;&nbsp;
      <a href="#M000415">notify_readable=</a>&nbsp;&nbsp;
      <a href="#M000416">notify_readable?</a>&nbsp;&nbsp;
      <a href="#M000417">notify_writable=</a>&nbsp;&nbsp;
      <a href="#M000418">notify_writable?</a>&nbsp;&nbsp;
      <a href="#M000419">pause</a>&nbsp;&nbsp;
      <a href="#M000421">paused?</a>&nbsp;&nbsp;
      <a href="#M000409">pending_connect_timeout</a>&nbsp;&nbsp;
      <a href="#M000410">pending_connect_timeout=</a>&nbsp;&nbsp;
      <a href="#M000380">post_init</a>&nbsp;&nbsp;
      <a href="#M000386">proxy_completed</a>&nbsp;&nbsp;
      <a href="#M000387">proxy_incoming_to</a>&nbsp;&nbsp;
      <a href="#M000385">proxy_target_unbound</a>&nbsp;&nbsp;
      <a href="#M000381">receive_data</a>&nbsp;&nbsp;
      <a href="#M000412">reconnect</a>&nbsp;&nbsp;
      <a href="#M000420">resume</a>&nbsp;&nbsp;
      <a href="#M000395">send_data</a>&nbsp;&nbsp;
      <a href="#M000400">send_datagram</a>&nbsp;&nbsp;
      <a href="#M000413">send_file_data</a>&nbsp;&nbsp;
      <a href="#M000408">set_comm_inactivity_timeout</a>&nbsp;&nbsp;
      <a href="#M000411">set_pending_connect_timeout</a>&nbsp;&nbsp;
      <a href="#M000393">set_sock_opt</a>&nbsp;&nbsp;
      <a href="#M000382">ssl_handshake_completed</a>&nbsp;&nbsp;
      <a href="#M000383">ssl_verify_peer</a>&nbsp;&nbsp;
      <a href="#M000398">start_tls</a>&nbsp;&nbsp;
      <a href="#M000388">stop_proxying</a>&nbsp;&nbsp;
      <a href="#M000414">stream_file_data</a>&nbsp;&nbsp;
      <a href="#M000384">unbind</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">



    <div id="aliases-list">
      <h3 class="section-bar">External Aliases</h3>

      <div class="name-list">
                        <table summary="aliases">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">method</td>
          <td>-&gt;</td>
          <td class="context-item-value">original_method</td>
        </tr>
      <tr class="top-aligned-row context-row">
        <td>&nbsp;</td>
        <td colspan="2" class="context-item-desc">
@private

</td>
      </tr>
                        </table>
      </div>
    </div>


    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">signature</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
@private

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000379" class="method-detail">
        <a name="M000379"></a>

        <div class="method-heading">
          <a href="Connection.src/M000379.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000379.html');return false;">
          <span class="method-name">new</span><span class="method-args">(*args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Stubbed initialize so legacy superclasses can safely call super
</p>
<p>
@private
</p>
        </div>
      </div>

      <div id="method-M000378" class="method-detail">
        <a name="M000378"></a>

        <div class="method-heading">
          <a href="Connection.src/M000378.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000378.html');return false;">
          <span class="method-name">new</span><span class="method-args">(sig, *args)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Override .<a href="Connection.html#M000378">new</a> so subclasses
don&#8216;t have to call super and can ignore connection-specific arguments
</p>
<p>
@private
</p>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000390" class="method-detail">
        <a name="M000390"></a>

        <div class="method-heading">
          <a href="Connection.src/M000390.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000390.html');return false;">
          <span class="method-name">close_connection</span><span class="method-args">(after_writing = false)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a
href="Connection.html#M000390">EventMachine::Connection#close_connection</a>
is called only by user code, and never by the event loop. You may call this
method against a connection object in any callback handler, whether or not
the callback was made against the connection you want to close. <a
href="Connection.html#M000390">close_connection</a> <em>schedules</em> the
connection to be closed at the next available opportunity within the event
loop. You may not assume that the connection is closed when <a
href="Connection.html#M000390">close_connection</a> returns. In particular,
the framework will callback the <a
href="Connection.html#M000384">unbind</a> method for the particular
connection at a point shortly after you call <a
href="Connection.html#M000390">close_connection</a>. You may assume that
the <a href="Connection.html#M000384">unbind</a> callback will take place
sometime after your call to <a
href="Connection.html#M000390">close_connection</a> completes. In other
words, the <a href="Connection.html#M000384">unbind</a> callback will not
re-enter your code &quot;inside&quot; of your call to <a
href="Connection.html#M000390">close_connection</a>. However, it&#8216;s
not guaranteed that a future version of <a
href="../EventMachine.html">EventMachine</a> will not change this behavior.
</p>
<p>
{<a href="Connection.html#M000390">close_connection</a>} will *silently
discard* any outbound data which you have sent to the connection using {<a
href="Connection.html#M000395">EventMachine::Connection#send_data</a>} but
which has not yet been sent across the network. If you want to avoid this
behavior, use {<a
href="Connection.html#M000394">EventMachine::Connection#close_connection_after_writing</a>}.
</p>
        </div>
      </div>

      <div id="method-M000394" class="method-detail">
        <a name="M000394"></a>

        <div class="method-heading">
          <a href="Connection.src/M000394.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000394.html');return false;">
          <span class="method-name">close_connection_after_writing</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
A variant of {<a href="Connection.html#M000390">close_connection</a>}. All
of the descriptive comments given for <a
href="Connection.html#M000390">close_connection</a> also apply to <a
href="Connection.html#M000394">close_connection_after_writing</a>, *with
one exception*: if the connection has outbound data sent using send_dat but
which has not yet been sent across the network, <a
href="Connection.html#M000394">close_connection_after_writing</a> will
schedule the connection to be closed <b>after</b> all of the outbound data
has been safely written to the remote peer.
</p>
<p>
Depending on the amount of outgoing data and the speed of the network,
considerable time may elapse between your call to <a
href="Connection.html#M000394">close_connection_after_writing</a> and the
actual closing of the socket (at which time the <a
href="Connection.html#M000384">unbind</a> callback will be called by the
event loop). During this time, you *may not* call <a
href="Connection.html#M000395">send_data</a> to transmit additional data
(that is, the connection is closed for further writes). In very rare cases,
you may experience a <a href="Connection.html#M000381">receive_data</a>
callback after your call to {<a
href="Connection.html#M000394">close_connection_after_writing</a>},
depending on whether incoming data was in the process of being received on
the connection at the moment when you called {<a
href="Connection.html#M000394">close_connection_after_writing</a>}. Your
protocol handler must be prepared to properly deal with such data (probably
by ignoring it).
</p>
<p>
@see <a href="Connection.html#M000390">close_connection</a> @see <a
href="Connection.html#M000395">send_data</a>
</p>
        </div>
      </div>

      <div id="method-M000406" class="method-detail">
        <a name="M000406"></a>

        <div class="method-heading">
          <a href="Connection.src/M000406.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000406.html');return false;">
          <span class="method-name">comm_inactivity_timeout</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a href="Connection.html#M000406">comm_inactivity_timeout</a> returns the
current value (float in seconds) of the inactivity-timeout property of
network-connection and datagram-socket objects. A nonzero value indicates
that the connection or socket will automatically be closed if no read or
write activity takes place for at least that number of seconds. A zero
value (the default) specifies that no automatic timeout will take place.
</p>
        </div>
      </div>

      <div id="method-M000407" class="method-detail">
        <a name="M000407"></a>

        <div class="method-heading">
          <a href="Connection.src/M000407.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000407.html');return false;">
          <span class="method-name">comm_inactivity_timeout=</span><span class="method-args">(value)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Allows you to set the inactivity-timeout property for a network connection
or datagram socket. Specify a non-negative float value in seconds. If the
value is greater than zero, the connection or socket will automatically be
closed if no read or write activity takes place for at least that number of
seconds. Specify a value of zero to indicate that no automatic timeout
should take place. Zero is the default value.
</p>
        </div>
      </div>

      <div id="method-M000397" class="method-detail">
        <a name="M000397"></a>

        <div class="method-heading">
          <a href="Connection.src/M000397.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000397.html');return false;">
          <span class="method-name">connection_completed</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Called by the event loop when a remote TCP connection attempt completes
successfully. You can expect to get this notification after calls to {<a
href="../EventMachine.html#M000058">EventMachine.connect</a>}. Remember
that <a href="../EventMachine.html">EventMachine</a> makes remote
connections asynchronously, just as with any other kind of network event.
This method is intended primarily to assist with network diagnostics. For
normal protocol handling, use <a
href="Connection.html#M000380">post_init</a> to perform initial work on a
<a href="Connection.html#M000378">new</a> connection (such as sending
initial set of data). {<a
href="Connection.html#M000380">Connection#post_init</a>} will always be
called. This method will only be called in case of a successful completion.
A connection attempt which fails will result a call to {<a
href="Connection.html#M000384">Connection#unbind</a>} after the failure.
</p>
<p>
@see <a href="Connection.html#M000380">Connection#post_init</a> @see <a
href="Connection.html#M000384">Connection#unbind</a> @see
file:docs/GettingStarted.md <a href="../EventMachine.html">EventMachine</a>
tutorial
</p>
        </div>
      </div>

      <div id="method-M000391" class="method-detail">
        <a name="M000391"></a>

        <div class="method-heading">
          <a href="Connection.src/M000391.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000391.html');return false;">
          <span class="method-name">detach</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Removes given connection from the event loop. The connection&#8216;s socket
remains open and its file descriptor number is returned.
</p>
        </div>
      </div>

      <div id="method-M000396" class="method-detail">
        <a name="M000396"></a>

        <div class="method-heading">
          <a href="Connection.src/M000396.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000396.html');return false;">
          <span class="method-name">error?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the connection is in an error state, false otherwise.
</p>
<p>
In general, you can detect the occurrence of communication errors or
unexpected disconnection by the remote peer by handing the {<a
href="Connection.html#M000384">unbind</a>} method. In some cases, however,
it&#8216;s useful to check the status of the connection using {error?}
before attempting to send data. This function is synchronous but it will
return immediately without blocking.
</p>
<p>
@return [Boolean] true if the connection is in an error state, false
otherwise
</p>
        </div>
      </div>

      <div id="method-M000405" class="method-detail">
        <a name="M000405"></a>

        <div class="method-heading">
          <a href="Connection.src/M000405.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000405.html');return false;">
          <span class="method-name">get_idle_time</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The number of seconds since the last send/receive activity on this
connection.
</p>
        </div>
      </div>

      <div id="method-M000422" class="method-detail">
        <a name="M000422"></a>

        <div class="method-heading">
          <a href="Connection.src/M000422.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000422.html');return false;">
          <span class="method-name">get_outbound_data_size</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
@private
</p>
        </div>
      </div>

      <div id="method-M000399" class="method-detail">
        <a name="M000399"></a>

        <div class="method-heading">
          <a href="Connection.src/M000399.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000399.html');return false;">
          <span class="method-name">get_peer_cert</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
If [TLS](<a
href="http://en.wikipedia.org/wiki/Transport_Layer_Security">en.wikipedia.org/wiki/Transport_Layer_Security</a>)
is active on the connection, returns the remote [X509 certificate](<a
href="http://en.wikipedia.org/wiki/X.509">en.wikipedia.org/wiki/X.509</a>)
as a string, in the popular [PEM format](<a
href="http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail">en.wikipedia.org/wiki/Privacy_Enhanced_Mail</a>).
This can then be used for arbitrary validation of a peer&#8216;s
certificate in your code.
</p>
<p>
This should be called in/after the {<a
href="Connection.html#M000382">ssl_handshake_completed</a>} callback, which
indicates that SSL/TLS is active. Using this callback is important, because
the certificate may not be available until the time it is executed. Using
<a href="Connection.html#M000380">post_init</a> or <a
href="Connection.html#M000397">connection_completed</a> is not adequate,
because the SSL handshake may still be taking place.
</p>
<p>
This method will return `nil` if:
</p>
<ul>
<li><a href="../EventMachine.html">EventMachine</a> is not built with
[OpenSSL](<a href="http://www.openssl.org">www.openssl.org</a>) support

</li>
<li>[TLS](<a
href="http://en.wikipedia.org/wiki/Transport_Layer_Security">en.wikipedia.org/wiki/Transport_Layer_Security</a>)
is not active on the connection

</li>
<li>TLS handshake is not yet complete

</li>
<li>Remote peer for any other reason has not presented a certificate

</li>
</ul>
<p>
@example Getting peer TLS certificate information in <a
href="../EventMachine.html">EventMachine</a>
</p>
<pre>
 module Handler
   def post_init
     puts &quot;Starting TLS&quot;
     start_tls
   end

   def ssl_handshake_completed
     puts get_peer_cert
     close_connection
   end

   def unbind
     EventMachine::stop_event_loop
   end
 end

  EventMachine.run do
    EventMachine.connect &quot;mail.google.com&quot;, 443, Handler
 end

 # Will output:
 # -----BEGIN CERTIFICATE-----
 # MIIDIjCCAougAwIBAgIQbldpChBPqv+BdPg4iwgN8TANBgkqhkiG9w0BAQUFADBM
 # MQswCQYDVQQGEwJaQTElMCMGA1UEChMcVGhhd3RlIENvbnN1bHRpbmcgKFB0eSkg
 # THRkLjEWMBQGA1UEAxMNVGhhd3RlIFNHQyBDQTAeFw0wODA1MDIxNjMyNTRaFw0w
 # OTA1MDIxNjMyNTRaMGkxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlh
 # MRYwFAYDVQQHEw1Nb3VudGFpbiBWaWV3MRMwEQYDVQQKEwpHb29nbGUgSW5jMRgw
 # FgYDVQQDEw9tYWlsLmdvb2dsZS5jb20wgZ8wDQYJKoZIhvcNAQEBBQADgY0AMIGJ
 # AoGBALlkxdh2QXegdElukCSOV2+8PKiONIS+8Tu9K7MQsYpqtLNC860zwOPQ2NLI
 # 3Zp4jwuXVTrtzGuiqf5Jioh35Ig3CqDXtLyZoypjZUQcq4mlLzHlhIQ4EhSjDmA7
 # Ffw9y3ckSOQgdBQWNLbquHh9AbEUjmhkrYxIqKXeCnRKhv6nAgMBAAGjgecwgeQw
 # KAYDVR0lBCEwHwYIKwYBBQUHAwEGCCsGAQUFBwMCBglghkgBhvhCBAEwNgYDVR0f
 # BC8wLTAroCmgJ4YlaHR0cDovL2NybC50aGF3dGUuY29tL1RoYXd0ZVNHQ0NBLmNy
 # bDByBggrBgEFBQcBAQRmMGQwIgYIKwYBBQUHMAGGFmh0dHA6Ly9vY3NwLnRoYXd0
 # ZS5jb20wPgYIKwYBBQUHMAKGMmh0dHA6Ly93d3cudGhhd3RlLmNvbS9yZXBvc2l0
 # b3J5L1RoYXd0ZV9TR0NfQ0EuY3J0MAwGA1UdEwEB/wQCMAAwDQYJKoZIhvcNAQEF
 # BQADgYEAsRwpLg1dgCR1gYDK185MFGukXMeQFUvhGqF8eT/CjpdvezyKVuz84gSu
 # 6ccMXgcPQZGQN/F4Xug+Q01eccJjRSVfdvR5qwpqCj+6BFl5oiKDBsveSkrmL5dz
 # s2bn7TdTSYKcLeBkjXxDLHGBqLJ6TNCJ3c4/cbbG5JhGvoema94=
 # -----END CERTIFICATE-----
</pre>
<p>
You can do whatever you want with the certificate String, such as load it
as a certificate object using the OpenSSL library, and check its fields.
</p>
<p>
@return [String] the remote [X509 certificate](<a
href="http://en.wikipedia.org/wiki/X.509">en.wikipedia.org/wiki/X.509</a>),
in the popular [PEM format](<a
href="http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail">en.wikipedia.org/wiki/Privacy_Enhanced_Mail</a>),
</p>
<pre>
                 if TLS is active on the connection
</pre>
<p>
@see <a href="Connection.html#M000398">Connection#start_tls</a> @see <a
href="Connection.html#M000382">Connection#ssl_handshake_completed</a>
</p>
        </div>
      </div>

      <div id="method-M000401" class="method-detail">
        <a name="M000401"></a>

        <div class="method-heading">
          <a href="Connection.src/M000401.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000401.html');return false;">
          <span class="method-name">get_peername</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This method is used with stream-connections to obtain the identity of the
remotely-connected peer. If a peername is available, this method returns a
sockaddr structure. The method returns nil if no peername is available. You
can use Socket.unpack_sockaddr_in and its variants to obtain the values
contained in the peername structure returned from <a
href="Connection.html#M000401">get_peername</a>.
</p>
<p>
@example How to get peer IP address and port with <a
href="../EventMachine.html">EventMachine</a>
</p>
<pre>
 require 'socket'

 module Handler
   def receive_data data
     port, ip = Socket.unpack_sockaddr_in(get_peername)
     puts &quot;got #{data.inspect} from #{ip}:#{port}&quot;
   end
 end
</pre>
        </div>
      </div>

      <div id="method-M000403" class="method-detail">
        <a name="M000403"></a>

        <div class="method-heading">
          <a href="Connection.src/M000403.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000403.html');return false;">
          <span class="method-name">get_pid</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the PID (kernel process identifier) of a subprocess associated with
this <a href="Connection.html">Connection</a> object. For use with {<a
href="../EventMachine.html#M000077">EventMachine.popen</a>} and similar
methods. Returns nil when there is no meaningful subprocess.
</p>
<p>
@return [Integer]
</p>
        </div>
      </div>

      <div id="method-M000389" class="method-detail">
        <a name="M000389"></a>

        <div class="method-heading">
          <a href="Connection.src/M000389.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000389.html');return false;">
          <span class="method-name">get_proxied_bytes</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The number of bytes proxied to another connection. Reset to zero when <a
href="Connection.html#M000387">EventMachine::Connection#proxy_incoming_to</a>
is called, and incremented whenever data is proxied.
</p>
        </div>
      </div>

      <div id="method-M000392" class="method-detail">
        <a name="M000392"></a>

        <div class="method-heading">
          <a href="Connection.src/M000392.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000392.html');return false;">
          <span class="method-name">get_sock_opt</span><span class="method-args">(level, option)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000402" class="method-detail">
        <a name="M000402"></a>

        <div class="method-heading">
          <a href="Connection.src/M000402.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000402.html');return false;">
          <span class="method-name">get_sockname</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Used with stream-connections to obtain the identity of the local side of
the connection. If a local name is available, this method returns a
sockaddr structure. The method returns nil if no local name is available.
You can use {Socket.unpack_sockaddr_in} and its variants to obtain the
values contained in the local-name structure returned from this method.
</p>
<p>
@example
</p>
<pre>
 require 'socket'

 module Handler
   def receive_data data
     port, ip = Socket.unpack_sockaddr_in(get_sockname)
     puts &quot;got #{data.inspect}&quot;
   end
 end
</pre>
        </div>
      </div>

      <div id="method-M000404" class="method-detail">
        <a name="M000404"></a>

        <div class="method-heading">
          <a href="Connection.src/M000404.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000404.html');return false;">
          <span class="method-name">get_status</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a subprocess exit status. Only useful for {<a
href="../EventMachine.html#M000077">EventMachine.popen</a>}. Call it in
your {<a href="Connection.html#M000384">unbind</a>} handler.
</p>
<p>
@return [Integer]
</p>
        </div>
      </div>

      <div id="method-M000415" class="method-detail">
        <a name="M000415"></a>

        <div class="method-heading">
          <a href="Connection.src/M000415.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000415.html');return false;">
          <span class="method-name">notify_readable=</span><span class="method-args">(mode)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Watches connection for readability. Only possible if the connection was
created using {<a
href="../EventMachine.html#M000061">EventMachine.attach</a>} and had
{EventMachine.notify_readable}/{EventMachine.notify_writable} defined on
the handler.
</p>
<p>
@see notify_readable?
</p>
        </div>
      </div>

      <div id="method-M000416" class="method-detail">
        <a name="M000416"></a>

        <div class="method-heading">
          <a href="Connection.src/M000416.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000416.html');return false;">
          <span class="method-name">notify_readable?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
@return [Boolean] true if the connection is being watched for readability.
</p>
        </div>
      </div>

      <div id="method-M000417" class="method-detail">
        <a name="M000417"></a>

        <div class="method-heading">
          <a href="Connection.src/M000417.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000417.html');return false;">
          <span class="method-name">notify_writable=</span><span class="method-args">(mode)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Watches connection for writeability. Only possible if the connection was
created using {<a
href="../EventMachine.html#M000061">EventMachine.attach</a>} and had
{EventMachine.notify_readable}/{EventMachine.notify_writable} defined on
the handler.
</p>
<p>
@see notify_writable?
</p>
        </div>
      </div>

      <div id="method-M000418" class="method-detail">
        <a name="M000418"></a>

        <div class="method-heading">
          <a href="Connection.src/M000418.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000418.html');return false;">
          <span class="method-name">notify_writable?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the connection is being watched for writability.
</p>
        </div>
      </div>

      <div id="method-M000419" class="method-detail">
        <a name="M000419"></a>

        <div class="method-heading">
          <a href="Connection.src/M000419.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000419.html');return false;">
          <span class="method-name">pause</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Pause a connection so that {<a
href="Connection.html#M000395">send_data</a>} and {<a
href="Connection.html#M000381">receive_data</a>} events are not fired until
{<a href="Connection.html#M000420">resume</a>} is called. @see <a
href="Connection.html#M000420">resume</a>
</p>
        </div>
      </div>

      <div id="method-M000421" class="method-detail">
        <a name="M000421"></a>

        <div class="method-heading">
          <a href="Connection.src/M000421.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000421.html');return false;">
          <span class="method-name">paused?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
@return [Boolean] true if the connect was paused using {<a
href="Connection.html#M000419">EventMachine::Connection#pause</a>}. @see <a
href="Connection.html#M000419">pause</a> @see <a
href="Connection.html#M000420">resume</a>
</p>
        </div>
      </div>

      <div id="method-M000409" class="method-detail">
        <a name="M000409"></a>

        <div class="method-heading">
          <a href="Connection.src/M000409.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000409.html');return false;">
          <span class="method-name">pending_connect_timeout</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
The duration after which a TCP connection in the connecting state will
fail. It is important to distinguish this value from {<a
href="Connection.html#M000406">EventMachine::Connection#comm_inactivity_timeout</a>},
which looks at how long since data was passed on an already established
connection. The value is a float in seconds.
</p>
<p>
@return [Float] The duration after which a TCP connection in the connecting
state will fail, in seconds.
</p>
        </div>
      </div>

      <div id="method-M000410" class="method-detail">
        <a name="M000410"></a>

        <div class="method-heading">
          <a href="Connection.src/M000410.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000410.html');return false;">
          <span class="method-name">pending_connect_timeout=</span><span class="method-args">(value)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets the duration after which a TCP connection in a connecting state will
fail.
</p>
<p>
@param [Float, to_f] value <a href="Connection.html">Connection</a> timeout
in seconds
</p>
        </div>
      </div>

      <div id="method-M000380" class="method-detail">
        <a name="M000380"></a>

        <div class="method-heading">
          <a href="Connection.src/M000380.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000380.html');return false;">
          <span class="method-name">post_init</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Called by the event loop immediately after the network connection has been
established, and before resumption of the network loop. This method is
generally not called by user code, but is called automatically by the event
loop. The base-class implementation is a no-op. This is a very good place
to initialize instance variables that will be used throughout the lifetime
of the network connection.
</p>
<p>
@see <a href="Connection.html#M000397">connection_completed</a> @see <a
href="Connection.html#M000384">unbind</a> @see <a
href="Connection.html#M000395">send_data</a> @see <a
href="Connection.html#M000381">receive_data</a>
</p>
        </div>
      </div>

      <div id="method-M000386" class="method-detail">
        <a name="M000386"></a>

        <div class="method-heading">
          <a href="Connection.src/M000386.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000386.html');return false;">
          <span class="method-name">proxy_completed</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
called when the reactor finished proxying all of the requested bytes.
</p>
        </div>
      </div>

      <div id="method-M000387" class="method-detail">
        <a name="M000387"></a>

        <div class="method-heading">
          <a href="Connection.src/M000387.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000387.html');return false;">
          <span class="method-name">proxy_incoming_to</span><span class="method-args">(conn,bufsize=0)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a
href="Connection.html#M000387">EventMachine::Connection#proxy_incoming_to</a>
is called only by user code. It sets up a low-level proxy relay for all
data inbound for this connection, to the connection given as the argument.
This is essentially just a helper method for enable_proxy.
</p>
<p>
@see <a href="../EventMachine.html#M000083">EventMachine.enable_proxy</a>
</p>
        </div>
      </div>

      <div id="method-M000385" class="method-detail">
        <a name="M000385"></a>

        <div class="method-heading">
          <a href="Connection.src/M000385.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000385.html');return false;">
          <span class="method-name">proxy_target_unbound</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Called by the reactor after attempting to relay incoming data to a
descriptor (set as a proxy target descriptor with {<a
href="../EventMachine.html#M000083">EventMachine.enable_proxy</a>}) that
has already been closed.
</p>
<p>
@see <a href="../EventMachine.html#M000083">EventMachine.enable_proxy</a>
</p>
        </div>
      </div>

      <div id="method-M000381" class="method-detail">
        <a name="M000381"></a>

        <div class="method-heading">
          <a href="Connection.src/M000381.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000381.html');return false;">
          <span class="method-name">receive_data</span><span class="method-args">(data)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Called by the event loop whenever data has been received by the network
connection. It is never called by user code. {<a
href="Connection.html#M000381">receive_data</a>} is called with a single
parameter, a String containing the network protocol data, which may of
course be binary. You will generally redefine this method to perform your
own processing of the incoming data.
</p>
<p>
Here&#8216;s a key point which is essential to understanding the
event-driven programming model: <em><a
href="../EventMachine.html">EventMachine</a> knows absolutely nothing about
the protocol which your code implements.</em> You must not make any
assumptions about the size of the incoming data packets, or about their
alignment on any particular intra-message or PDU boundaries (such as line
breaks). <a href="Connection.html#M000381">receive_data</a> can and will
send you arbitrary chunks of data, with the only guarantee being that the
data is presented to your code in the order it was collected from the
network. Don&#8216;t even assume that the chunks of data will correspond to
network packets, as <a href="../EventMachine.html">EventMachine</a> can and
will coalesce several incoming packets into one, to improve performance.
The implication for your code is that you generally will need to implement
some kind of a state machine in your redefined implementation of <a
href="Connection.html#M000381">receive_data</a>. For a better understanding
of this, read through the examples of specific protocol handlers in <a
href="Protocols.html">EventMachine::Protocols</a>
</p>
<p>
The base-class implementation (which will be invoked only if you
didn&#8216;t override it in your protocol handler) simply prints incoming
data packet size to stdout.
</p>
<p>
@param [String] data Opaque incoming data. @note Depending on the protocol,
buffer sizes and OS networking stack configuration, incoming data may or
may not be &quot;a complete message&quot;.
</p>
<pre>
      It is up to this handler to detect content boundaries to determine whether all the content (for example, full HTTP request)
      has been received and can be processed.
</pre>
<p>
@see <a href="Connection.html#M000380">post_init</a> @see <a
href="Connection.html#M000397">connection_completed</a> @see <a
href="Connection.html#M000384">unbind</a> @see <a
href="Connection.html#M000395">send_data</a> @see
file:docs/GettingStarted.md <a href="../EventMachine.html">EventMachine</a>
tutorial
</p>
        </div>
      </div>

      <div id="method-M000412" class="method-detail">
        <a name="M000412"></a>

        <div class="method-heading">
          <a href="Connection.src/M000412.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000412.html');return false;">
          <span class="method-name">reconnect</span><span class="method-args">(server, port)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Reconnect to a given host/port with the current instance
</p>
<p>
@param [String] server Hostname or IP address @param [Integer] port Port to
<a href="Connection.html#M000412">reconnect</a> to
</p>
        </div>
      </div>

      <div id="method-M000420" class="method-detail">
        <a name="M000420"></a>

        <div class="method-heading">
          <a href="Connection.src/M000420.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000420.html');return false;">
          <span class="method-name">resume</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Resume a connection&#8216;s {<a
href="Connection.html#M000395">send_data</a>} and {<a
href="Connection.html#M000381">receive_data</a>} events. @see <a
href="Connection.html#M000419">pause</a>
</p>
        </div>
      </div>

      <div id="method-M000395" class="method-detail">
        <a name="M000395"></a>

        <div class="method-heading">
          <a href="Connection.src/M000395.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000395.html');return false;">
          <span class="method-name">send_data</span><span class="method-args">(data)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Call this method to send data to the remote end of the network connection.
It takes a single String argument, which may contain binary data. Data is
buffered to be sent at the end of this event loop tick (cycle).
</p>
<p>
When used in a method that is event handler (for example, {<a
href="Connection.html#M000380">post_init</a>} or {<a
href="Connection.html#M000397">connection_completed</a>}, it will send data
to the other end of the connection that generated the event. You can also
call {<a href="Connection.html#M000395">send_data</a>} to write to other
connections. For more information see The Chat Server Example in the
{file:docs/GettingStarted.md <a
href="../EventMachine.html">EventMachine</a> tutorial}.
</p>
<p>
If you want to send some data and then immediately close the connection,
make sure to use {<a
href="Connection.html#M000394">close_connection_after_writing</a>} instead
of {<a href="Connection.html#M000390">close_connection</a>}.
</p>
<p>
@param [String] data Data to send asynchronously
</p>
<p>
@see file:docs/GettingStarted.md <a
href="../EventMachine.html">EventMachine</a> tutorial @see <a
href="Connection.html#M000381">Connection#receive_data</a> @see <a
href="Connection.html#M000380">Connection#post_init</a> @see <a
href="Connection.html#M000384">Connection#unbind</a>
</p>
        </div>
      </div>

      <div id="method-M000400" class="method-detail">
        <a name="M000400"></a>

        <div class="method-heading">
          <a href="Connection.src/M000400.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000400.html');return false;">
          <span class="method-name">send_datagram</span><span class="method-args">(data, recipient_address, recipient_port)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sends UDP messages.
</p>
<p>
This method may be called from any <a href="Connection.html">Connection</a>
object that refers to an open datagram socket (see <a
href="../EventMachine.html#M000065">EventMachine#open_datagram_socket</a>).
The method sends a UDP (datagram) packet containing the data you specify,
to a remote peer specified by the IP address and port that you give as
parameters to the method. Observe that you may send a zero-length packet
(empty string). However, you may not send an arbitrarily-large data packet
because your operating system will enforce a platform-specific limit on the
size of the outbound packet. (Your kernel will respond in a
platform-specific way if you send an overlarge packet: some will send a
truncated packet, some will complain, and some will silently drop your
request). On LANs, it&#8216;s usually OK to send datagrams up to about 4000
bytes in length, but to be really safe, send messages smaller than the
Ethernet-packet size (typically about 1400 bytes). Some very restrictive
WANs will either drop or truncate packets larger than about 500 bytes.
</p>
<p>
@param [String] data Data to send asynchronously @param [String]
recipient_address IP address of the recipient @param [String]
recipient_port Port of the recipient
</p>
        </div>
      </div>

      <div id="method-M000413" class="method-detail">
        <a name="M000413"></a>

        <div class="method-heading">
          <a href="Connection.src/M000413.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000413.html');return false;">
          <span class="method-name">send_file_data</span><span class="method-args">(filename)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Like {<a
href="Connection.html#M000395">EventMachine::Connection#send_data</a>},
this sends data to the remote end of the network connection. {<a
href="Connection.html#M000413">EventMachine::Connection#send_file_data</a>}
takes a filename as an argument, though, and sends the contents of the
file, in one chunk.
</p>
<p>
@param [String] filename Local path of the file to send
</p>
<p>
@see <a href="Connection.html#M000395">send_data</a> @author Kirk Haines
</p>
        </div>
      </div>

      <div id="method-M000408" class="method-detail">
        <a name="M000408"></a>

        <div class="method-heading">
          <span class="method-name">set_comm_inactivity_timeout</span><span class="method-args">(value)</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Connection.html#M000406">comm_inactivity_timeout</a>=
</p>
        </div>
      </div>

      <div id="method-M000411" class="method-detail">
        <a name="M000411"></a>

        <div class="method-heading">
          <span class="method-name">set_pending_connect_timeout</span><span class="method-args">(value)</span>
        </div>
      
        <div class="method-description">
          <p>
Alias for <a href="Connection.html#M000409">pending_connect_timeout</a>=
</p>
        </div>
      </div>

      <div id="method-M000393" class="method-detail">
        <a name="M000393"></a>

        <div class="method-heading">
          <a href="Connection.src/M000393.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000393.html');return false;">
          <span class="method-name">set_sock_opt</span><span class="method-args">(level, optname, optval)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000382" class="method-detail">
        <a name="M000382"></a>

        <div class="method-heading">
          <a href="Connection.src/M000382.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000382.html');return false;">
          <span class="method-name">ssl_handshake_completed</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Called by <a href="../EventMachine.html">EventMachine</a> when the SSL/TLS
handshake has been completed, as a result of calling <a
href="Connection.html#M000398">start_tls</a> to initiate SSL/TLS on the
connection.
</p>
<p>
This callback exists because {<a
href="Connection.html#M000380">post_init</a>} and {<a
href="Connection.html#M000397">connection_completed</a>} are *<b>not</b>*
reliable for indicating when an SSL/TLS connection is ready to have its
certificate queried for.
</p>
<p>
@see <a href="Connection.html#M000399">get_peer_cert</a>
</p>
        </div>
      </div>

      <div id="method-M000383" class="method-detail">
        <a name="M000383"></a>

        <div class="method-heading">
          <a href="Connection.src/M000383.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000383.html');return false;">
          <span class="method-name">ssl_verify_peer</span><span class="method-args">(cert)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Called by <a href="../EventMachine.html">EventMachine</a> when :verify_peer
=&gt; true has been passed to {<a
href="Connection.html#M000398">start_tls</a>}. It will be called with each
certificate in the certificate chain provided by the remote peer.
</p>
<p>
The cert will be passed as a String in PEM format, the same as in {<a
href="Connection.html#M000399">get_peer_cert</a>}. It is up to user defined
code to perform a check on the certificates. The return value from this
callback is used to accept or deny the peer. A return value that is not nil
or false triggers acceptance. If the peer is not accepted, the connection
will be subsequently closed.
</p>
<p>
@example This server always accepts all peers
</p>
<pre>
  module AcceptServer
    def post_init
      start_tls(:verify_peer =&gt; true)
    end

    def ssl_verify_peer(cert)
      true
    end

    def ssl_handshake_completed
      $server_handshake_completed = true
    end
  end
</pre>
<p>
@example This server never accepts any peers
</p>
<pre>
  module DenyServer
    def post_init
      start_tls(:verify_peer =&gt; true)
    end

    def ssl_verify_peer(cert)
      # Do not accept the peer. This should now cause the connection to shut down
      # without the SSL handshake being completed.
      false
    end

    def ssl_handshake_completed
      $server_handshake_completed = true
    end
  end
</pre>
<p>
@see <a href="Connection.html#M000398">start_tls</a>
</p>
        </div>
      </div>

      <div id="method-M000398" class="method-detail">
        <a name="M000398"></a>

        <div class="method-heading">
          <a href="Connection.src/M000398.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000398.html');return false;">
          <span class="method-name">start_tls</span><span class="method-args">(args={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Call {<a href="Connection.html#M000398">start_tls</a>} at any point to
initiate TLS encryption on connected streams. The method is smart enough to
know whether it should perform a server-side or a client-side handshake. An
appropriate place to call {<a href="Connection.html#M000398">start_tls</a>}
is in your redefined {<a href="Connection.html#M000380">post_init</a>}
method, or in the {<a
href="Connection.html#M000397">connection_completed</a>} handler for an
outbound connection.
</p>
<p>
@option args [String] :cert_chain_file (nil) local path of a readable file
that contants a chain of X509 certificates in
</p>
<pre>
                                             the [PEM format](http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail),
                                             with the most-resolved certificate at the top of the file, successive intermediate
                                             certs in the middle, and the root (or CA) cert at the bottom.
</pre>
<p>
@option args [String] :private_key_file (nil) local path of a readable file
that must contain a private key in the [PEM format](<a
href="http://en.wikipedia.org/wiki/Privacy_Enhanced_Mail">en.wikipedia.org/wiki/Privacy_Enhanced_Mail</a>).
</p>
<p>
@option args [String] :verify_peer (false) indicates whether a server
should request a certificate from a peer, to be verified by user code.
</p>
<pre>
                                              If true, the {#ssl_verify_peer} callback on the {EventMachine::Connection} object is called with each certificate
                                              in the certificate chain provided by the peer. See documentation on {#ssl_verify_peer} for how to use this.
</pre>
<p>
@example Using TLS with <a href="../EventMachine.html">EventMachine</a>
</p>
<pre>
 require 'rubygems'
 require 'eventmachine'

 module Handler
   def post_init
     start_tls(:private_key_file =&gt; '/tmp/server.key', :cert_chain_file =&gt; '/tmp/server.crt', :verify_peer =&gt; false)
   end
 end

  EventMachine.run do
   EventMachine.start_server(&quot;127.0.0.1&quot;, 9999, Handler)
 end
</pre>
<p>
@param [Hash] args
</p>
<p>
@todo support passing an encryption parameter, which can be string or Proc,
to get a passphrase for encrypted private keys. @todo support passing key
material via raw strings or Procs that return strings instead of just
filenames.
</p>
<p>
@see <a href="Connection.html#M000383">ssl_verify_peer</a>
</p>
        </div>
      </div>

      <div id="method-M000388" class="method-detail">
        <a name="M000388"></a>

        <div class="method-heading">
          <a href="Connection.src/M000388.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000388.html');return false;">
          <span class="method-name">stop_proxying</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
A helper method for {<a
href="../EventMachine.html#M000084">EventMachine.disable_proxy</a>}
</p>
        </div>
      </div>

      <div id="method-M000414" class="method-detail">
        <a name="M000414"></a>

        <div class="method-heading">
          <a href="Connection.src/M000414.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000414.html');return false;">
          <span class="method-name">stream_file_data</span><span class="method-args">(filename, args={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Open a file on the filesystem and send it to the remote peer. This returns
an object of type {<a href="Deferrable.html">EventMachine::Deferrable</a>}.
The object&#8216;s callbacks will be executed on the reactor main thread
when the file has been completely scheduled for transmission to the remote
peer. Its errbacks will be called in case of an error (such as
file-not-found). This method employs various strategies to achieve the
fastest possible performance, balanced against minimum consumption of
memory.
</p>
<p>
Warning: this feature has an implicit dependency on an outboard extension,
evma_fastfilereader. You must install this extension in order to use {<a
href="Connection.html#M000414">stream_file_data</a>} with files larger than
a certain size (currently 8192 bytes).
</p>
<p>
@option args [Boolean] :http_chunks (false) If true, this method will
stream the file data in a format
</p>
<pre>
                                            compatible with the HTTP chunked-transfer encoding
</pre>
<p>
@param [String] filename Local path of the file to stream @param [Hash]
args Options
</p>
<p>
@return [<a href="Deferrable.html">EventMachine::Deferrable</a>]
</p>
        </div>
      </div>

      <div id="method-M000384" class="method-detail">
        <a name="M000384"></a>

        <div class="method-heading">
          <a href="Connection.src/M000384.html" target="Code" class="method-signature"
            onclick="popupCode('Connection.src/M000384.html');return false;">
          <span class="method-name">unbind</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
called by the framework whenever a connection (either a server or client
connection) is closed. The close can occur because your code intentionally
closes it (using {<a href="Connection.html#M000390">close_connection</a>}
and {<a
href="Connection.html#M000394">close_connection_after_writing</a>}),
because the remote peer closed the connection, or because of a network
error. You may not assume that the network connection is still open and
able to send or receive data when the callback to <a
href="Connection.html#M000384">unbind</a> is made. This is intended only to
give you a chance to clean up associations your code may have made to the
connection object while it was open.
</p>
<p>
If you want to detect which peer has closed the connection, you can
override {<a href="Connection.html#M000390">close_connection</a>} in your
protocol handler and set an @ivar.
</p>
<p>
@example Overriding <a
href="Connection.html#M000390">Connection#close_connection</a> to
distinguish connections closed on our side
</p>
<pre>
  class MyProtocolHandler &lt; EventMachine::Connection

    # ...

    def close_connection(*args)
      @intentionally_closed_connection = true
      super(*args)
    end

    def unbind
      if @intentionally_closed_connection
        # ...
      end
    end

    # ...

  end
</pre>
<p>
@see <a href="Connection.html#M000380">post_init</a> @see <a
href="Connection.html#M000397">connection_completed</a> @see
file:docs/GettingStarted.md <a href="../EventMachine.html">EventMachine</a>
tutorial
</p>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>